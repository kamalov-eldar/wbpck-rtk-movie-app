"use strict";(self.webpackChunkwbpck_rtk_movie_app=self.webpackChunkwbpck_rtk_movie_app||[]).push([[371],{3206:(e,n,a)=>{a.d(n,{q:()=>i});var r=a(5893),t=a(4184),o=a.n(t),l=a(7294);var i=function(e){var n=e.className,a=e.src,t=e.size,i=e.alt,c=(0,l.useMemo)((function(){return{width:t||100,height:t||100}}),[t]);return(0,r.jsx)("img",{src:a,alt:i,style:c,className:o()("O2_Sw_cX",{},[n])})}},1126:(e,n,a)=>{a.d(n,{W:()=>l});var r=a(5893),t=a(7294),o=a(9704),l=function(e){var n=e.children,a=e.reducers,l=e.removeAfterUnmount,i=(0,o.I0)(),c=(0,o.oR)();return(0,t.useEffect)((function(){return Object.entries(a).forEach((function(e){var n=e[0],a=e[1];c.reducerManager.add(n,a),i({type:"@INIT ".concat(n," reducer")})})),function(){l&&Object.entries(a).forEach((function(e){var n=e[0];e[1],c.reducerManager.remove(n),i({type:"@DESTROY ".concat(n," reducer")})}))}}),[]),(0,r.jsx)(r.Fragment,{children:n})}},6375:(e,n,a)=>{a.d(n,{I:()=>c});var r=a(5893),t=a(7294),o=a(4184),l=a.n(o);var i=function(){return i=Object.assign||function(e){for(var n,a=1,r=arguments.length;a<r;a++)for(var t in n=arguments[a])Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e},i.apply(this,arguments)},c=(0,t.memo)((function(e){var n,a=e.className,o=e.value,c=e.onChange,u=e.type,s=void 0===u?"text":u,d=e.autofocus,f=e.readonly,v=e.placeholder,p=e.label,h=e.field,y=e.children,m=function(e,n){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var t=0;for(r=Object.getOwnPropertySymbols(e);t<r.length;t++)n.indexOf(r[t])<0&&Object.prototype.propertyIsEnumerable.call(e,r[t])&&(a[r[t]]=e[r[t]])}return a}(e,["className","value","onChange","type","autofocus","readonly","placeholder","label","field","children"]),C=(0,t.useRef)(null),g=(0,t.useState)(!1),b=(g[0],g[1]),R=(0,t.useState)(0),j=(R[0],R[1]);(0,t.useEffect)((function(){var e;d&&(b(!0),null===(e=C.current)||void 0===e||e.focus())}),[d]);var N=((n={}).NxmlmKTJ=f,n);return(0,r.jsxs)("div",i({className:l()("uzRTtkkb",{},[a])},{children:[p&&(0,r.jsx)("label",i({htmlFor:"".concat(h,"-field"),className:"D5A6B0j9"},{children:"".concat(p)})),(0,r.jsx)("input",i({id:"".concat(h,"-field"),ref:C,type:s,value:o,onChange:function(e){null==c||c(e.target.value),j(e.target.value.length)},className:l()("pnO5GHiv",{},[N]),onFocus:function(){b(!0)},onBlur:function(){b(!1)},onSelect:function(e){var n;j((null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.selectionStart)||0)},readOnly:f,placeholder:v},m)),y]}))}))},5371:(e,n,a)=>{a.r(n),a.d(n,{default:()=>q});var r,t=a(5893),o=a(1126),l=a(3418),i=(0,l.hg)("profile/fetchProfileData",(function(e,n){return a=void 0,r=void 0,o=function(){var a,r;return function(e,n){var a,r,t,o,l={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(c){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(l=0)),l;)try{if(a=1,r&&(t=2&i[0]?r.return:i[0]?r.throw||((t=r.return)&&t.call(r),0):r.next)&&!(t=t.call(r,i[1])).done)return t;switch(r=0,t&&(i=[2&i[0],t.value]),i[0]){case 0:case 1:t=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!((t=(t=l.trys).length>0&&t[t.length-1])||6!==i[0]&&2!==i[0])){l=0;continue}if(3===i[0]&&(!t||i[1]>t[0]&&i[1]<t[3])){l.label=i[1];break}if(6===i[0]&&l.label<t[1]){l.label=t[1],t=i;break}if(t&&l.label<t[2]){l.label=t[2],l.ops.push(i);break}t[2]&&l.ops.pop(),l.trys.pop();continue}i=n.call(e,l)}catch(e){i=[6,e],r=0}finally{a=t=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,n.extra.api.get("/profile/".concat(e))];case 1:if(!(a=t.sent()).data)throw new Error;return[2,a.data];case 2:return r=t.sent(),console.log("error-fetchProfileData: ",r),[2,n.rejectWithValue("Произошла ошибка при загрузке профиля")];case 3:return[2]}}))},new((t=void 0)||(t=Promise))((function(e,n){function l(e){try{c(o.next(e))}catch(e){n(e)}}function i(e){try{c(o.throw(e))}catch(e){n(e)}}function c(n){var a;n.done?e(n.value):(a=n.value,a instanceof t?a:new t((function(e){e(a)}))).then(l,i)}c((o=o.apply(a,r||[])).next())}));var a,r,t,o}));!function(e){e.INCORRECT_USER_DATA="INCORRECT_USER_DATA",e.INCORRECT_AGE="INCORRECT_AGE",e.INCORRECT_COUNTRY="INCORRECT_COUNTRY",e.NO_DATA="NO_DATA",e.SERVER_ERROR="SERVER_ERROR"}(r||(r={}));var c=function(e){var n;return null===(n=e.profile)||void 0===n?void 0:n.form},u=(0,l.hg)("profile/updateProfileData",(function(e,n){return a=void 0,t=void 0,l=function(){var e,a,t,o,l,i,u;return function(e,n){var a,r,t,o,l={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(c){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(l=0)),l;)try{if(a=1,r&&(t=2&i[0]?r.return:i[0]?r.throw||((t=r.return)&&t.call(r),0):r.next)&&!(t=t.call(r,i[1])).done)return t;switch(r=0,t&&(i=[2&i[0],t.value]),i[0]){case 0:case 1:t=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!((t=(t=l.trys).length>0&&t[t.length-1])||6!==i[0]&&2!==i[0])){l=0;continue}if(3===i[0]&&(!t||i[1]>t[0]&&i[1]<t[3])){l.label=i[1];break}if(6===i[0]&&l.label<t[1]){l.label=t[1],t=i;break}if(t&&l.label<t[2]){l.label=t[2],l.ops.push(i);break}t[2]&&l.ops.pop(),l.trys.pop();continue}i=n.call(e,l)}catch(e){i=[6,e],r=0}finally{a=t=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(s){switch(s.label){case 0:if(e=n.extra,a=n.rejectWithValue,t=n.getState,o=c(t()),console.log("formData: ",o),(l=function(e){if(!e)return[r.NO_DATA];var n=e.firstname,a=e.lastname,t=e.age,o=e.country,l=[];return n&&a||l.push(r.INCORRECT_USER_DATA),t&&Number.isInteger(t)||l.push(r.INCORRECT_AGE),o||l.push(r.INCORRECT_COUNTRY),l}(o)).length)return[2,a(l)];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,e.api.put("/profile/".concat(null==o?void 0:o.id),o)];case 2:if(!(i=s.sent()).data)throw new Error("");return[2,i.data];case 3:return u=s.sent(),console.log(u),[2,a([r.SERVER_ERROR])];case 4:return[2]}}))},new((o=void 0)||(o=Promise))((function(e,n){function r(e){try{c(l.next(e))}catch(e){n(e)}}function i(e){try{c(l.throw(e))}catch(e){n(e)}}function c(n){var a;n.done?e(n.value):(a=n.value,a instanceof o?a:new o((function(e){e(a)}))).then(r,i)}c((l=l.apply(a,t||[])).next())}));var a,t,o,l})),s=function(){return s=Object.assign||function(e){for(var n,a=1,r=arguments.length;a<r;a++)for(var t in n=arguments[a])Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e},s.apply(this,arguments)},d=(0,l.oM)({name:"profile",initialState:{readonly:!0,isLoading:!1,error:void 0,data:void 0},reducers:{setProfileData:function(e,n){e.data=n.payload},setReadonly:function(e,n){e.readonly=n.payload},cancelEdit:function(e){e.readonly=!0,e.form=e.data},updateProfile:function(e,n){e.form=s(s({},e.data),n.payload)}},extraReducers:function(e){e.addCase(i.pending,(function(e){e.error=void 0,e.isLoading=!0})).addCase(i.fulfilled,(function(e,n){e.isLoading=!1,e.data=n.payload,e.form=n.payload})).addCase(i.rejected,(function(e,n){e.error=n.payload,e.isLoading=!1})).addCase(u.pending,(function(e){e.validateErrors=void 0,e.isLoading=!0})).addCase(u.fulfilled,(function(e,n){e.isLoading=!1,e.data=n.payload,e.form=n.payload,e.readonly=!0,e.validateErrors=void 0})).addCase(u.rejected,(function(e,n){e.validateErrors=n.payload,e.isLoading=!1}))}}),f=d.actions,v=d.reducer,p=a(7294),h=a(9506),y=a(9704),m=a(4184),C=a.n(m);const g={ProfileCard:"hhJw1mgk",ProfileCard__container:"m2UCMI0E",ProfileCard__header:"wOWRFsrw",ProfileCard__body:"kBTy9caD",editBtn:"h2oZfuGU",body__wrapper:"JkRtDWV4"};var b=a(6375),R=a(4502),j=a(3206);var N,x,O=function(){return O=Object.assign||function(e){for(var n,a=1,r=arguments.length;a<r;a++)for(var t in n=arguments[a])Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e},O.apply(this,arguments)},E=(0,p.memo)((function(e){var n,a=e.className,r=e.label,o=e.options,l=e.onChange,i=e.value,c=e.readonly,u=(0,p.useMemo)((function(){return null==o?void 0:o.map((function(e){return(0,t.jsx)("option",O({className:"QvWRhihP",value:e.value},{children:e.content}),e.value)}))}),[o]),s=((n={}).eIDAOtcr=c,n);return(0,t.jsxs)("div",O({className:C()("HrqLFIGF",s,[a])},{children:[r&&(0,t.jsx)("span",O({className:"EjEbigCn"},{children:"".concat(r)})),(0,t.jsx)("select",O({disabled:c,className:C()("u5ir2GDa",{},[s]),value:i,onChange:function(e){l&&l(e.target.value)}},{children:u}))]}))}));!function(e){e.RUB="RUB",e.EUR="EUR",e.USD="USD"}(N||(N={})),function(e){e.Russia="Russia",e.Cuba="Cuba",e.Brasil="Brasil",e.Madagascar="Madagascar",e.Bahamas="Bahamas"}(x||(x={}));var _=[{value:N.RUB,content:N.RUB},{value:N.EUR,content:N.EUR},{value:N.USD,content:N.USD}],w=(0,p.memo)((function(e){var n=e.className,a=e.value,r=e.onChange,o=e.readonly,l=(0,p.useCallback)((function(e){null==r||r(e)}),[r]);return(0,t.jsx)(E,{className:C()("",{},[n]),label:"Укажите валюту",options:_,value:a,onChange:l,readonly:o})})),P=[{value:x.Russia,content:x.Russia},{value:x.Brasil,content:x.Brasil},{value:x.Bahamas,content:x.Bahamas},{value:x.Cuba,content:x.Cuba},{value:x.Madagascar,content:x.Madagascar}],k=(0,p.memo)((function(e){var n=e.className,a=e.value,r=e.onChange,o=e.readonly,l=(0,p.useCallback)((function(e){null==r||r(e)}),[r]);return(0,t.jsx)(E,{className:C()("",{},[n]),label:"Укажите страну",options:P,value:a,onChange:l,readonly:o})})),T=function(){return T=Object.assign||function(e){for(var n,a=1,r=arguments.length;a<r;a++)for(var t in n=arguments[a])Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e},T.apply(this,arguments)},A=function(e){var n=e.profile,a=e.error,r=e.isLoading,o=e.readonly,l=e.onChangeFirstname,i=e.onChangeLastname,c=e.onChangeAge,u=e.onChangeCity,s=e.onChangeAvatar,d=e.onChangeUsername,f=e.onChangeCountry,v=e.onChangeCurrency;return r?(0,t.jsx)("div",T({className:C()(g.ProfileCard,{},[])},{children:(0,t.jsx)(R.a,{})})):a?(0,t.jsx)("div",T({className:C()(g.ProfileCard,{},[])},{children:(0,t.jsx)("div",T({className:"errorBlock"},{children:a&&(0,t.jsx)("p",T({className:"errorText"},{children:a}))}))})):n?(0,t.jsx)("div",T({className:C()(g.ProfileCard,{},[])},{children:(0,t.jsxs)("div",T({className:C()(g.ProfileCard__container,{},[])},{children:[(0,t.jsx)("div",T({className:g.ProfileCard__header},{children:(null==n?void 0:n.avatar)&&(0,t.jsx)("div",T({className:g.avatarWrapper},{children:(0,t.jsx)(j.q,{src:null==n?void 0:n.avatar})}))})),(0,t.jsx)("div",T({className:g.ProfileCard__body},{children:(0,t.jsxs)("div",T({className:g.body__wrapper},{children:[(0,t.jsx)(b.I,{value:null==n?void 0:n.firstname,readonly:o,onChange:l,autofocus:!0,type:"text",placeholder:"Ваше имя",label:"Ваше имя",field:"name"}),(0,t.jsx)(b.I,{value:null==n?void 0:n.lastname,readonly:o,onChange:i,type:"text",placeholder:"Ваша фамилия",label:"Ваша фамилия",field:"surname"}),(0,t.jsx)(b.I,{value:null==n?void 0:n.age,placeholder:"Ваш возраст",label:"Ваш возраст",className:g.input,onChange:c,readonly:o,field:"age"}),(0,t.jsx)(b.I,{value:null==n?void 0:n.city,placeholder:"Город",label:"Город",className:g.input,onChange:u,readonly:o,field:"city"}),(0,t.jsx)(b.I,{value:null==n?void 0:n.username,placeholder:"Введите имя пользователя",label:"Введите имя пользователя",className:g.input,onChange:d,readonly:o,field:"userName"}),(0,t.jsx)(b.I,{value:null==n?void 0:n.avatar,placeholder:"Введите ссылку на аватар",label:"Введите ссылку на аватар",className:g.input,onChange:s,readonly:o,field:"srcAvatar"}),(0,t.jsx)(w,{className:g.input,value:null==n?void 0:n.currency,onChange:v,readonly:o}),(0,t.jsx)(k,{className:g.input,value:null==n?void 0:n.country,onChange:f,readonly:o})]}))}))]}))})):(0,t.jsx)(t.Fragment,{children:"no data profile"})},I=function(e){var n;return null===(n=e.profile)||void 0===n?void 0:n.isLoading},U=function(e){var n;return null===(n=e.profile)||void 0===n?void 0:n.error},S=function(e){var n;return null===(n=e.profile)||void 0===n?void 0:n.data},D=a(4866);const B={ProfilePageHeader:"ZAbbvK1p",editBtn:"DaXEFrW9",PageHeader__title:"pvijDcBf",btnsWrapper:"_YE0O4HS"};var L=a(2333),F=function(e){var n;return null===(n=e.profile)||void 0===n?void 0:n.readonly},W=a(3655),G=function(){return G=Object.assign||function(e){for(var n,a=1,r=arguments.length;a<r;a++)for(var t in n=arguments[a])Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e},G.apply(this,arguments)},M=function(){var e=(0,h.T)(),n=(0,D.F)().theme,a=(0,y.v9)(F),r=(0,y.v9)(W.P),o=(0,y.v9)(S),l=(null==r?void 0:r.id)===(null==o?void 0:o.id),i=(0,p.useCallback)((function(){e(f.setReadonly(!1))}),[e]),c=(0,p.useCallback)((function(){e(f.cancelEdit())}),[e]),s=(0,p.useCallback)((function(){e(u())}),[e]);return(0,t.jsxs)("div",G({className:C()(B.ProfilePageHeader,{},[])},{children:[(0,t.jsx)("p",G({className:C()(B.PageHeader__title,{},[n])},{children:"Профиль"})),l&&(0,t.jsx)("div",G({className:B.btnsWrapper},{children:a?(0,t.jsx)(L.ZP,G({className:B.editBtn,theme:L.bn.OUTLINE,onClick:i},{children:"Редактировать"})):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(L.ZP,G({className:B.editBtn,theme:L.bn.OUTLINE,onClick:c},{children:"Отменить"})),(0,t.jsx)(L.ZP,G({className:B.saveBtn,theme:L.bn.OUTLINE,onClick:s},{children:"Сохранить"}))]})}))]}))},H=function(e){var n;return null===(n=e.profile)||void 0===n?void 0:n.validateErrors},V=a(9250),Y=function(){return Y=Object.assign||function(e){for(var n,a=1,r=arguments.length;a<r;a++)for(var t in n=arguments[a])Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e},Y.apply(this,arguments)},Z={profile:v};const q=function(){var e,n=(0,D.F)().theme,a=(0,h.T)(),l=((0,y.v9)(S),(0,y.v9)(c)),u=(0,y.v9)(I),s=(0,y.v9)(U),d=(0,y.v9)(F),v=(0,y.v9)(H),m=(0,V.UO)().id,g=((e={})[r.SERVER_ERROR]="Серверная ошибка при сохранении",e[r.INCORRECT_COUNTRY]="Некорректный регион",e[r.NO_DATA]="Данные не указаны",e[r.INCORRECT_USER_DATA]="Имя и фамилия обязательны",e[r.INCORRECT_AGE]="Некорректный возраст",e);(0,p.useEffect)((function(){m&&a(i(m))}),[a,m]);var b=(0,p.useCallback)((function(e){a(f.updateProfile({firstname:e||""}))}),[a]),R=(0,p.useCallback)((function(e){a(f.updateProfile({lastname:e||""}))}),[a]),j=(0,p.useCallback)((function(e){a(f.updateProfile({city:e||""}))}),[a]),N=(0,p.useCallback)((function(e){a(f.updateProfile({age:Number(e||0)}))}),[a]),x=(0,p.useCallback)((function(e){a(f.updateProfile({username:e||""}))}),[a]),O=(0,p.useCallback)((function(e){a(f.updateProfile({avatar:e||""}))}),[a]),E=(0,p.useCallback)((function(e){a(f.updateProfile({currency:e}))}),[a]),_=(0,p.useCallback)((function(e){a(f.updateProfile({country:e}))}),[a]);return(0,t.jsx)(o.W,Y({reducers:Z,removeAfterUnmount:!0},{children:(0,t.jsxs)("div",Y({className:C()("Crw2kdr1",{},[n])},{children:[(0,t.jsx)(M,{}),(null==v?void 0:v.length)&&v.map((function(e){return(0,t.jsx)("div",Y({className:"errorText"},{children:g[e]}),e)})),(0,t.jsx)(A,{readonly:d,profile:l,isLoading:u,error:s,onChangeFirstname:b,onChangeLastname:R,onChangeAge:N,onChangeCity:j,onChangeUsername:x,onChangeAvatar:O,onChangeCurrency:E,onChangeCountry:_})]}))}))}}}]);